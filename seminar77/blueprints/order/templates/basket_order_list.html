<!DOCTYPE html>
<html>
<head>
    <title>–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <center>
            <h2>üõí –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫</h2>
            <a href="{{ url_for('main_menu') }}" class="btn btn-secondary">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</a>
        </center>

        <div class="row mt-4">
            <!-- –¢–æ–≤–∞—Ä—ã -->
            <div class="col-md-8">
                <h3>–¢–æ–≤–∞—Ä—ã</h3>
                {% for product in products %}
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">{{ product.prod_name }}</h5>
                        <p class="card-text">–¶–µ–Ω–∞: {{ product.prod_price }} —Ä—É–±.</p>
                        <form action="{{ url_for('bp_order.add_to_basket') }}" method="POST">
                            <input type="hidden" name="prod_id" value="{{ product.prod_id }}">
                            <input type="hidden" name="prod_name" value="{{ product.prod_name }}">
                            <input type="hidden" name="prod_price" value="{{ product.prod_price }}">
                            <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h3>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h3>
                    </div>
                    <div class="card-body">
                        {% if basket %}
                            {% for prod_id, item in basket.items() %}
                            <div class="card mb-2">
                                <div class="card-body">
                                    <h6>{{ item.prod_name }}</h6>
                                    <p>–¶–µ–Ω–∞: {{ item.prod_price }} —Ä—É–±. x {{ item.amount }}</p>
                                    <p>–°—É–º–º–∞: {{ item.prod_price * item.amount }} —Ä—É–±.</p>
                                    <form action="{{ url_for('bp_order.remove_from_basket', prod_id=prod_id) }}" method="POST">
                                        <button type="submit" class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</button>
                                    </form>
                                </div>
                            </div>
                            {% endfor %}

                            <!-- –û–±—â–∞—è —Å—É–º–º–∞ -->
                            {% set total_sum = namespace(value=0) %}
                            {% for item in basket.values() %}
                                {% set total_sum.value = total_sum.value + (item.prod_price * item.amount) %}
                            {% endfor %}

                            <div class="mt-3 p-2 bg-light rounded">
                                <h5>–û–±—â–∞—è —Å—É–º–º–∞: {{ total_sum.value }} —Ä—É–±.</h5>
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∏ -->
                            <form action="{{ url_for('bp_order.checkout') }}" method="POST" class="mt-2">
                                <button type="submit" class="btn btn-success w-100">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
                            </form>

                            <form action="{{ url_for('bp_order.clear_basket') }}" method="POST" class="mt-2">
                                <button type="submit" class="btn btn-warning w-100">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
                            </form>
                        {% else %}
                            <p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>